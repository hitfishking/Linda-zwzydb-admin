/*
 * File: app/view/MainViewport.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Linda_db_admin.view.MainViewport', {
    extend: 'Ext.container.Viewport',

    requires: [
        'Ext.form.Panel',
        'Ext.form.Label',
        'Ext.tab.Panel',
        'Ext.tab.Tab',
        'Ext.tree.Panel',
        'Ext.tree.View',
        'Ext.toolbar.Toolbar',
        'Ext.menu.Menu',
        'Ext.menu.Item',
        'Ext.grid.plugin.CellEditing',
        'Ext.tree.Column',
        'Ext.toolbar.Fill',
        'Ext.form.FieldSet',
        'Ext.form.field.ComboBox',
        'Ext.form.field.TextArea',
        'Ext.grid.Panel',
        'Ext.grid.View',
        'Ext.grid.column.Number'
    ],

    autoScroll: true,
    layout: 'border',

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            items: [
                {
                    xtype: 'container',
                    region: 'west',
                    width: 170
                },
                {
                    xtype: 'container',
                    region: 'center',
                    layout: 'border',
                    items: [
                        {
                            xtype: 'form',
                            region: 'north',
                            border: false,
                            height: 75,
                            bodyPadding: 10,
                            frameHeader: false,
                            items: [
                                {
                                    xtype: 'label',
                                    height: 0,
                                    html: '<h1>园林植物种质资源数据库  数据管理系统</h1>',
                                    width: 0
                                }
                            ]
                        },
                        {
                            xtype: 'tabpanel',
                            region: 'center',
                            activeTab: 0,
                            tabPosition: 'left',
                            items: [
                                {
                                    xtype: 'panel',
                                    layout: 'border',
                                    title: '科属种维护',
                                    items: [
                                        {
                                            xtype: 'treepanel',
                                            region: 'west',
                                            split: true,
                                            border: '0,0,0,30',
                                            frame: true,
                                            width: 240,
                                            autoScroll: true,
                                            collapsible: true,
                                            title: '科属列表/维护',
                                            store: 'KeShuTreeStore',
                                            animate: true,
                                            rootVisible: false,
                                            viewConfig: {
                                                rootVisible: false
                                            },
                                            dockedItems: [
                                                {
                                                    xtype: 'toolbar',
                                                    dock: 'top',
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            icon: 'icons/new.png',
                                                            tooltip: '新建',
                                                            menu: {
                                                                xtype: 'menu',
                                                                width: 120,
                                                                items: [
                                                                    {
                                                                        xtype: 'menuitem',
                                                                        handler: function(item, e) {
                                                                            //新建科
                                                                            //直接在tree.Panel中增加新节点即可.
                                                                            mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                            rootnode = mytree.getRootNode();

                                                                            rootnode.insertBefore(
                                                                            {
                                                                                text: 'New 科',
                                                                                leaf: false,
                                                                                ntype: '科',
                                                                                expanded: true,
                                                                                newnode: true
                                                                            },
                                                                            rootnode.getChildAt(0)
                                                                            );

                                                                            // rootnode.appendChild({text: 'New Node', leaf: false});


                                                                        },
                                                                        text: '新建科'
                                                                    },
                                                                    {
                                                                        xtype: 'menuitem',
                                                                        handler: function(item, e) {
                                                                            //新建属
                                                                            //首先确定选择的节点，该节点必须为ntype="科"
                                                                            //然后向其下append新节点。
                                                                            mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                            selectedNode = mytree.getSelectionModel().getSelection()[0];

                                                                            if (selectedNode.data.ntype == '科'){
                                                                                selectedNode.appendChild(
                                                                                {
                                                                                    text: 'New 属',
                                                                                    leaf: false,
                                                                                    ntype: '属',
                                                                                    expanded: true,
                                                                                    newnode: true
                                                                                }
                                                                                );
                                                                            } else {
                                                                                Ext.MessageBox.alert('提示','请先选择一个科！');
                                                                            }




                                                                        },
                                                                        text: '新建属'
                                                                    }
                                                                ]
                                                            }
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                // mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                // mytree.fireEvent('beforeedit', this);

                                                            },
                                                            icon: 'icons/edit.png',
                                                            tooltip: '编辑'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                mytree.store.load();

                                                            },
                                                            icon: 'icons/undo.png',
                                                            tooltip: '撤销修改'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                mytree.store.sync({
                                                                    success: function(batch, options){
                                                                        Ext.MessageBox.alert('成功','保存成功！');
                                                                        mytree.store.load();   //保存后，重新载入，保证取得服务器为新节点生成的id.
                                                                    },
                                                                    failure: function(batch, options){
                                                                        Ext.MessageBox.alert('失败','保存失败！请排除问题后再试！');
                                                                    }

                                                                });




                                                            },
                                                            icon: 'icons/save.png',
                                                            tooltip: '保存到服务器'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                //只能选择科、属进行删除，种不能删除。
                                                                //级联删除前需要进行确认。

                                                                mytree = this.up('treepanel[title="科属列表/维护"]');
                                                                selectedNode = mytree.getSelectionModel().getSelection()[0];

                                                                if (typeof(selectedNode) == 'undefined') {
                                                                    Ext.MessageBox.alert('提示','请先选择一个科或属，以便进行删除！');
                                                                    return;
                                                                }

                                                                if (selectedNode.data.ntype == '科'){
                                                                    promptmsg = '删除【'+selectedNode.data.text+'】节点,将删除其下的所有属节点和种节点！确认删除吗?';
                                                                } else {
                                                                    promptmsg = '删除【'+selectedNode.data.text+'】节点,将删除其下的所有种节点！确认删除吗?';
                                                                }

                                                                if ((selectedNode.data.ntype == '科') || (selectedNode.data.ntype == '属')) {

                                                                    Ext.MessageBox.confirm('删除警告', promptmsg, delconfirm, this);

                                                                } else {
                                                                    Ext.MessageBox.alert('提示','请先选择一个科或属，以便进行删除！');
                                                                    return;
                                                                }


                                                                //handler函数对象内部的自定义函数.
                                                                function delconfirm(id){
                                                                    if (id == 'yes'){
                                                                        selectedNode.remove(true);
                                                                        return;
                                                                    } else {
                                                                        return;
                                                                    }
                                                                }
                                                            },
                                                            itemId: 'btnDelete',
                                                            icon: 'icons/delete.gif',
                                                            tooltip: '删除'
                                                        }
                                                    ]
                                                }
                                            ],
                                            listeners: {
                                                itemdblclick: {
                                                    fn: me.onTreepanelItemDblClick,
                                                    scope: me
                                                }
                                            },
                                            plugins: [
                                                Ext.create('Ext.grid.plugin.CellEditing', {
                                                    listeners: {
                                                        beforeedit: {
                                                            fn: me.onCellEditingBeforeEdit,
                                                            scope: me
                                                        }
                                                    }
                                                })
                                            ],
                                            columns: [
                                                {
                                                    xtype: 'treecolumn',
                                                    height: 0,
                                                    dataIndex: 'text',
                                                    flex: 1,
                                                    editor: {
                                                        xtype: 'textfield',
                                                        selectOnFocus: true
                                                    }
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'form',
                                            readonly: true,
                                            region: 'center',
                                            id: '',
                                            itemId: 'formZhong',
                                            autoScroll: true,
                                            bodyPadding: 10,
                                            title: '种编辑表单',
                                            dockedItems: [
                                                {
                                                    xtype: 'toolbar',
                                                    dock: 'top',
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                theFormPanel = this.up('form[title="种编辑表单"]');
                                                                theForm = theFormPanel.getForm();


                                                                if (theFormPanel.readOnly) {

                                                                    theForm.getFields().each (function (field) {
                                                                        field.setReadOnly (false);
                                                                    });
                                                                    theFormPanel.readOnly = false;
                                                                    this.setText("退出编辑态");

                                                                } else {

                                                                    theForm.getFields().each (function (field) {
                                                                        field.setReadOnly (true);
                                                                    });
                                                                    theFormPanel.readOnly = true;
                                                                    this.setText("进入编辑态");

                                                                }








                                                            },
                                                            scale: 'medium',
                                                            text: '进入编辑态',
                                                            tooltip: '切换编辑/保护状态'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                theForm = this.up('form[title="种编辑表单"]');
                                                                theForm.updateRecord();

                                                                // if (!theForm.isValid()) {
                                                                //    alert('Have invalid values.');
                                                                //     return;
                                                                // }


                                                                theRecord=theForm.getRecord();

                                                                theRecord.store.sync({
                                                                    success: function(batch, options){
                                                                        Ext.MessageBox.alert('成功', batch.proxy.getReader().rawData.message);
                                                                    },
                                                                    failure: function(batch, options){
                                                                        Ext.MessageBox.alert('失败', batch.proxy.getReader().rawData.message);
                                                                    }
                                                                });


                                                            },
                                                            icon: 'icons/save.png',
                                                            text: '保存种',
                                                            tooltip: '保存到服务器'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                theForm = this.up('form[title="种编辑表单"]');
                                                                theRecord=theForm.getRecord();
                                                                console.log(theRecord);

                                                                if (typeof(theRecord) == 'undefined') {
                                                                    Ext.MessageBox.alert('提示','当前没有要删除的记录!');
                                                                    return;
                                                                }


                                                                Ext.MessageBox.confirm('删除警告', '确认删除当前种吗?', delconfirm, this);


                                                                //handler函数对象内部的自定义函数.
                                                                function delconfirm(id){
                                                                    if (id == 'yes'){
                                                                        Ext.getStore('ZhongStore').remove(theRecord);
                                                                        Ext.getStore('ZhongStore').sync({
                                                                            success: function(batch, options){
                                                                                Ext.MessageBox.alert('成功', batch.proxy.getReader().rawData.message);

                                                                            },
                                                                            failure: function(batch, options){
                                                                                Ext.MessageBox.alert('失败', batch.proxy.getReader().rawData.message);
                                                                            }
                                                                        });

                                                                        theForm.getForm().reset();

                                                                    } else {
                                                                        return;
                                                                    }
                                                                }





                                                            },
                                                            icon: 'icons/delete.gif',
                                                            text: '删除种',
                                                            tooltip: '删除当前种'
                                                        },
                                                        {
                                                            xtype: 'tbfill'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                //将当前form.record add到指定的本地store中；

                                                                theForm = this.up('form[title="种编辑表单"]');
                                                                theForm.updateRecord();
                                                                theRecord=theForm.getRecord();

                                                                theStore = Ext.getStore('ZhongStoreLocal');
                                                                theStore.add(theRecord);

                                                                Ext.MessageBox.alert('成功','拷贝完成!');

                                                            },
                                                            text: '拷贝'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                //弹出窗口，显示当前本地store中存储的内容；
                                                                //选择一行，粘贴，则逐一record.get(fieldname),并复制给相应的form.field字段；
                                                                //一些特殊字段须要特殊处理；


                                                                theWindow = Ext.create('Linda_db_admin.view.winCPZhong');
                                                                theWindow.show();
                                                            },
                                                            text: '粘贴'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                //只有在用户已经在树上选择了一个属，且该属下没有种的情况下，才能建立一个新种。
                                                                //新种的建立，是在空的store中加入一个新记录，并上提到form上。

                                                                // mytree = Ext.ComponentQuery.query('treepanel[title="科属列表/维护"]');
                                                                // selectedNode = mytree.getSelectionModel().getSelection()[0];

                                                                // if (selectedNode.data.ntype == '属'){
                                                                // //   selectedNode.appendChild(
                                                                // //     {
                                                                // //         text: 'New 属',
                                                                // //         leaf: false,
                                                                // //         ntype: '属',
                                                                // //         expanded: true,
                                                                // //         newnode: true
                                                                // //     }
                                                                // //   );
                                                                // } else {
                                                                //   alert("请先在左侧科属树种，选择种所属的选择一个属！");
                                                                // }
                                                                //--------------------------------------------------------------------------
                                                                //新建种，是在一个独立的"空间"内实施的，不需要从外部引入信息。
                                                                //具体逻辑是：在store中加入一条新记录，并将其上提到form上。

                                                                //首先清除ZhongStore中可能存在的记录，保证只有一条记录在ZhongStore中。
                                                                Ext.getStore('ZhongStore').removeAll();

                                                                zhongAdded = Ext.getStore('ZhongStore').add({zhong_id: '111'});

                                                                theFormPanel = this.up('form[title="种编辑表单"]');
                                                                theFormPanel.loadRecord(zhongAdded[0]);


                                                            },
                                                            icon: 'icons/new.png',
                                                            scale: 'medium',
                                                            text: '新建种',
                                                            tooltip: '新建一个新种'
                                                        }
                                                    ]
                                                }
                                            ],
                                            items: [
                                                {
                                                    xtype: 'fieldset',
                                                    height: 83,
                                                    title: '科属信息',
                                                    items: [
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            itemId: 'kecombo',
                                                            maxHeight: 160,
                                                            fieldLabel: '科名',
                                                            labelWidth: 40,
                                                            name: 'ke_id',
                                                            allowBlank: false,
                                                            emptyText: '请选择一个科',
                                                            editable: false,
                                                            displayField: 'name',
                                                            forceSelection: true,
                                                            queryMode: 'local',
                                                            store: 'KeStore',
                                                            valueField: '_id',
                                                            listeners: {
                                                                select: {
                                                                    fn: me.onKecomboSelect,
                                                                    scope: me
                                                                }
                                                            }
                                                        },
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            itemId: 'shucombo',
                                                            fieldLabel: '属名',
                                                            labelWidth: 40,
                                                            name: 'shu_id2',
                                                            allowBlank: false,
                                                            emptyText: '请选择一个属',
                                                            editable: false,
                                                            displayField: 'name',
                                                            forceSelection: true,
                                                            queryMode: 'local',
                                                            store: 'ShuStore',
                                                            valueField: '_id'
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '种名称',
                                                    labelWidth: 50,
                                                    name: 'cname',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '拉丁名',
                                                    labelWidth: 50,
                                                    name: 'ldname',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '别名',
                                                    labelWidth: 50,
                                                    name: 'aliases'
                                                },
                                                {
                                                    xtype: 'combobox',
                                                    anchor: '100%',
                                                    formBind: false,
                                                    fieldLabel: '形态',
                                                    labelWidth: 50,
                                                    name: 'xingtai',
                                                    allowBlank: false,
                                                    editable: false,
                                                    queryMode: 'local',
                                                    store: [
                                                        '乔木',
                                                        '落叶大乔木',
                                                        '落叶小乔木',
                                                        '常绿乔木',
                                                        '灌木',
                                                        '藤本',
                                                        '宿根',
                                                        '水生',
                                                        '草本',
                                                        '草坪',
                                                        '地被'
                                                    ],
                                                    listeners: {
                                                        select: {
                                                            fn: me.onComboboxSelect,
                                                            scope: me
                                                        }
                                                    }
                                                },
                                                {
                                                    xtype: 'combobox',
                                                    anchor: '100%',
                                                    fieldLabel: '功能性状',
                                                    labelWidth: 60,
                                                    name: 'gongneng',
                                                    allowBlank: false,
                                                    editable: false,
                                                    multiSelect: true,
                                                    store: [
                                                        '耐阴',
                                                        '耐寒',
                                                        '耐旱',
                                                        '耐水湿',
                                                        '耐盐碱',
                                                        '耐修剪',
                                                        '抗风',
                                                        '抗病虫害',
                                                        '抗污染'
                                                    ]
                                                },
                                                {
                                                    xtype: 'combobox',
                                                    anchor: '100%',
                                                    fieldLabel: '观赏',
                                                    labelWidth: 50,
                                                    name: 'guanshang',
                                                    allowBlank: false,
                                                    editable: false,
                                                    forceSelection: true,
                                                    multiSelect: true,
                                                    queryMode: 'local',
                                                    store: [
                                                        '观花',
                                                        '观叶',
                                                        '观果',
                                                        '观枝',
                                                        '观皮'
                                                    ]
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    fieldLabel: '花期',
                                                    labelWidth: 50,
                                                    name: 'huaqi',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'textfield',
                                                    anchor: '100%',
                                                    cls: 'readonly_text',
                                                    overCls: 'readonly_text',
                                                    fieldLabel: '图片地址',
                                                    labelWidth: 60,
                                                    name: 'pics',
                                                    readOnly: true,
                                                    readOnlyCls: 'readonly_text',
                                                    allowBlank: false
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    border: 3,
                                                    collapsible: true,
                                                    title: '生态数据',
                                                    items: [
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '根系',
                                                            labelWidth: 50,
                                                            name: 'shengtai.genxi',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            fieldLabel: '空气湿度',
                                                            labelWidth: 60,
                                                            name: 'shengtai.huminity',
                                                            allowBlank: false,
                                                            store: [
                                                                '高湿(100%~85%)',
                                                                '中湿(85%~60%)',
                                                                '较干(60%~30%)',
                                                                '干燥(30%~0%)'
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            fieldLabel: '光照强度',
                                                            labelWidth: 60,
                                                            name: 'shengtai.light',
                                                            allowBlank: false,
                                                            store: [
                                                                '全光',
                                                                '全光50%',
                                                                '全光30%',
                                                                '散射光',
                                                                '弱光'
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            fieldLabel: '土壤湿度',
                                                            labelWidth: 60,
                                                            name: 'shengtai.moisture',
                                                            allowBlank: false,
                                                            store: [
                                                                '耐涝',
                                                                '中等水分',
                                                                '耐干旱'
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '栽植难易性',
                                                            labelWidth: 70,
                                                            name: 'shengtai.nanyi',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '耐盐碱性',
                                                            labelWidth: 60,
                                                            name: 'shengtai.salt',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '寿命',
                                                            labelWidth: 50,
                                                            name: 'shengtai.shouming',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '土壤',
                                                            labelWidth: 50,
                                                            name: 'shengtai.soil',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'combobox',
                                                            anchor: '100%',
                                                            fieldLabel: '生长速度',
                                                            labelWidth: 60,
                                                            name: 'shengtai.sudu',
                                                            allowBlank: false,
                                                            editable: false,
                                                            store: [
                                                                '很快',
                                                                '较快',
                                                                '中等速度',
                                                                '缓慢'
                                                            ]
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '适宜温度',
                                                            labelWidth: 60,
                                                            name: 'shengtai.temperature',
                                                            allowBlank: false
                                                        }
                                                    ]
                                                },
                                                {
                                                    xtype: 'fieldset',
                                                    anchor: '100%',
                                                    border: 3,
                                                    width: 150,
                                                    collapsible: true,
                                                    title: '工程数据',
                                                    items: [
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            height: 74,
                                                            fieldLabel: '自然区域',
                                                            labelWidth: 60,
                                                            name: 'engineering.ziran_quyu',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '应用区域',
                                                            labelWidth: 60,
                                                            name: 'engineering.yingyong_quyu',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '识别特征',
                                                            labelWidth: 60,
                                                            name: 'engineering.shibie_tezheng',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '种植密度',
                                                            labelWidth: 60,
                                                            name: 'engineering.zhongzhi_midu',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            width: 150,
                                                            fieldLabel: '苗木规格',
                                                            labelWidth: 60,
                                                            name: 'engineering.miaomu_guige',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '设计建议',
                                                            labelWidth: 60,
                                                            name: 'engineering.sheji_jianyi',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '施工要点',
                                                            labelWidth: 60,
                                                            name: 'engineering.shigong_yaodian',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textareafield',
                                                            anchor: '100%',
                                                            fieldLabel: '养护要点',
                                                            labelWidth: 60,
                                                            name: 'engineering.yanghu_yaodian',
                                                            allowBlank: false
                                                        },
                                                        {
                                                            xtype: 'textfield',
                                                            anchor: '100%',
                                                            fieldLabel: '参考价格',
                                                            labelWidth: 60,
                                                            name: 'engineering.cankao_jiage',
                                                            allowBlank: false
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            region: 'east',
                                            frame: true,
                                            width: 250,
                                            autoScroll: true,
                                            collapsed: false,
                                            collapsible: true,
                                            title: '种图片维护',
                                            layout: {
                                                type: 'vbox',
                                                align: 'stretch'
                                            },
                                            dockedItems: [
                                                {
                                                    xtype: 'toolbar',
                                                    dock: 'top',
                                                    border: 4,
                                                    items: [
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                theWindow = Ext.create('Linda_db_admin.view.winSelectPic');
                                                                theWindow.show();
                                                            },
                                                            icon: 'icons/new.png',
                                                            text: '增加图片'
                                                        },
                                                        {
                                                            xtype: 'button',
                                                            handler: function(button, e) {
                                                                picGridPanel = this.up('panel[title="种图片维护"]').down('gridpanel');
                                                                picStore = picGridPanel.getStore();

                                                                selectedRecord = picGridPanel.getSelectionModel().getSelection()[0];
                                                                if (typeof(selectedRecord) == 'undefined') {
                                                                    Ext.MessageBox.alert('提示','请选择要删除的图片！');
                                                                    return;
                                                                }

                                                                Ext.MessageBox.confirm('删除警告', '确认删除此文件吗?', delconfirm, this);


                                                                //handler函数对象内部的自定义函数.
                                                                function delconfirm(id){
                                                                    if (id == 'yes'){
                                                                        picStore.remove(selectedRecord);

                                                                        //添加pic_path参数
                                                                        theForm = Ext.ComponentQuery.query('form[title="种编辑表单"]')[0];

                                                                        pic_path = theForm.getRecord().get('pics');
                                                                        if (pic_path === "" || typeof(pic_path) == 'undefined'){
                                                                            Ext.MessageBox.alert('错误提示','没有定义该种植物的图片目录，请检查！');
                                                                            return false;
                                                                        } else {

                                                                            picStore.getProxy().setExtraParam('picpath', pic_path);

                                                                            picStore.sync({
                                                                                success: function(batch, options){
                                                                                    Ext.MessageBox.alert('成功', batch.proxy.getReader().rawData.message);
                                                                                },
                                                                                failure: function(batch, options){
                                                                                    Ext.MessageBox.alert('失败', batch.proxy.getReader().rawData.message);
                                                                                }
                                                                            });

                                                                        }

                                                                    } else {
                                                                        return;
                                                                    }
                                                                }



                                                            },
                                                            icon: 'icons/delete.gif',
                                                            text: '删除图片'
                                                        }
                                                    ]
                                                }
                                            ],
                                            items: [
                                                {
                                                    xtype: 'gridpanel',
                                                    flex: 1,
                                                    store: 'PicStore',
                                                    viewConfig: {
                                                        width: 190
                                                    },
                                                    columns: [
                                                        {
                                                            xtype: 'gridcolumn',
                                                            renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                                strHtml = '<img style="width:97%; margin:0px; padding:0px;" src="' + value + '"/>' +
                                                                '<p style="margin:0px 0px 5px 0px; text-align:center">'+ record.get('pic_name') + '</p>';


                                                                return strHtml;
                                                            },
                                                            height: 0,
                                                            width: 190,
                                                            dataIndex: 'pic_path',
                                                            text: 'Pic_path',
                                                            flex: 1
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            hidden: true,
                                                            dataIndex: 'pic_name',
                                                            text: 'Pic_name'
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            xtype: 'panel',
                                            region: 'west',
                                            width: 0,
                                            layout: 'border',
                                            bodyBorder: false,
                                            collapsed: false,
                                            collapsible: true,
                                            title: 'My Panel',
                                            items: [
                                                {
                                                    xtype: 'gridpanel',
                                                    region: 'center',
                                                    title: 'My Grid Panel',
                                                    store: 'ZhongStore',
                                                    columns: [
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'ke_id',
                                                            text: 'Ke_id'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'ke_name',
                                                            text: 'Ke_name'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shu_id2',
                                                            text: 'Shu_id2'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shu_name',
                                                            text: 'Shu_name'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'zhong_id',
                                                            text: 'Zhong_id'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'cname',
                                                            text: 'Cname'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'ldname',
                                                            text: 'Ldname'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'aliases',
                                                            text: 'Aliases'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'xingtai',
                                                            text: 'Xingtai'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'gongneng',
                                                            text: 'Gongneng'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'guanshang',
                                                            text: 'Guanshang'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'huaqi',
                                                            text: 'Huaqi'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'pics',
                                                            text: 'Pics'
                                                        },
                                                        {
                                                            xtype: 'numbercolumn',
                                                            dataIndex: 'pic_count',
                                                            text: 'Pic_count',
                                                            format: '0,000'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.genxi',
                                                            text: 'Shengtai.genxi'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.huminity',
                                                            text: 'Shengtai.huminity'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.light',
                                                            text: 'Shengtai.light'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.moisture',
                                                            text: 'Shengtai.moisture'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.nanyi',
                                                            text: 'Shengtai.nanyi'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.salt',
                                                            text: 'Shengtai.salt'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.shouming',
                                                            text: 'Shengtai.shouming'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.soil',
                                                            text: 'Shengtai.soil'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.sudu',
                                                            text: 'Shengtai.sudu'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'shengtai.temperature',
                                                            text: 'Shengtai.temperature'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.cankao_jiage',
                                                            text: 'Engineering.cankao_jiage'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.miaomu_guige',
                                                            text: 'Engineering.miaomu_guige'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.sheji_jianyi',
                                                            text: 'Engineering.sheji_jianyi'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.shibie_tezheng',
                                                            text: 'Engineering.shibie_tezheng'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.shigong_yaodian',
                                                            text: 'Engineering.shigong_yaodian'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.yanghu_yaodian',
                                                            text: 'Engineering.yanghu_yaodian'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.yingyong_quyu',
                                                            text: 'Engineering.yingyong_quyu'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.zhongzhi_midu',
                                                            text: 'Engineering.zhongzhi_midu'
                                                        },
                                                        {
                                                            xtype: 'gridcolumn',
                                                            dataIndex: 'engineering.ziran_quyu',
                                                            text: 'Engineering.ziran_quyu'
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    xtype: 'panel',
                                    title: '编辑'
                                },
                                {
                                    xtype: 'panel',
                                    title: '参数'
                                }
                            ]
                        }
                    ]
                },
                {
                    xtype: 'container',
                    region: 'east',
                    width: 170
                }
            ]
        });

        me.callParent(arguments);
    },

    onTreepanelItemDblClick: function(dataview, record, item, index, e, eOpts) {
        // alert(record.data.text + record.data.leaf + record.data.expanded + record.data.children);
        // alert(record.get('text')+ record.get('id')+record.get('leaf'));

        if (record.isLeaf()) {
           Ext.getStore('ZhongStore').load({
                params: {
                    id: record.get('id'),
                  text: record.get('text'),
                  leaf: record.get('leaf')
                }
           });

           Ext.getStore('PicStore').load({
                params: {
                    id: record.get('id'),
                  text: record.get('text'),
                  leaf: record.get('leaf')
                }
           });
        }


    },

    onCellEditingBeforeEdit: function(editor, e, eOpts) {
        //叶节点禁止编辑
        //利用了Model(record)上由NodeInterface提供的tree node操作的方法和属性。

        if (e.record.isLeaf()) {
          return false;
        }

    },

    onKecomboSelect: function(combo, records, eOpts) {
        theForm = this.down('form[itemId="formZhong"]');  //this是整个viewport
        theShuCombo = theForm.down('combobox[itemId="shucombo"]');

        selectedKeId = records[0].data._id;

        theShuCombo.store.clearFilter(true);
        theShuCombo.store.filter("ke_id",selectedKeId);
        // theShuCombo.rawValue = '';
        theShuCombo.clearValue();  //清空显示，以便让用户重新选择.

        console.log(records[0]);



    },

    onComboboxSelect: function(combo, records, eOpts) {
        xingtai = records[0].get('field1');

        theForm = combo.up('form[title="种编辑表单"]').getForm();
        cname = theForm.findField('cname').getValue();

        if ((typeof(cname) == 'undefined') || (cname === "")) {
           Ext.MessageBox.alert('提示','种名称为空! 请先指定种名称!');
           return;
        }

        theForm.findField('pics').setValue(xingtai +'/'+ cname + '/' );





    }

});